---
title: "Melodic Trajectories"
author: "Gijs Oliemans"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
runtime: shiny
---



```{r setup, include=FALSE}

library(flexdashboard)
library(dplyr)
library(tidyverse)
library(lubridate)
library(spotifyr)
library(plotly)
library(shiny)
library(treemap)
```

```{r loading, include=FALSE}
# Loading datasets
beatles <- get_playlist_audio_features("", "5YPyQdiRzU0xolryQHqhNv") 
rhcp <- get_playlist_audio_features("", "04rfJgMUHRVg3d7iL3dLPU")
fela_kuti <- get_playlist_audio_features("", "7kdOWMLqjh2nfBPqvZ6zGd")
daft_punk <- get_playlist_audio_features("", "49In2rUl8PCWKC6yAETu9G")
bjork <- get_playlist_audio_features("", "19Ar68GhVwnuSNgw7CtF7y")
miles_davis <- get_playlist_audio_features("", "1qK5njkyEremnIBvPbw36O")
radiohead <- get_playlist_audio_features("", "0GedvaI33dOhxTaJTnh80p")
youssoundour <- get_playlist_audio_features("","23IgCQB3p9ZhJtD4wPwQAC")
caetanoveloso <- get_playlist_audio_features("", "6PEjftDLv1ro1R8y4GwUAn")
```

```{r combining, include=FALSE}
beatles$artist <- "Beatles"
rhcp$artist <- "RHCP"
fela_kuti$artist <- "Fela Kuti"
daft_punk$artist <- "Daft Punk"
bjork$artist <- "Bjork"
miles_davis$artist <- "Miles Davis"
radiohead$artist <- "Radiohead"
youssoundour$artist <- "Youssou N'Dour"
caetanoveloso$artist <- "Caetano Veloso"
corpus <- rbind(beatles, rhcp, fela_kuti, daft_punk, bjork, miles_davis, radiohead, youssoundour, caetanoveloso)

```

```{r message=FALSE, include=FALSE}


# Grouping and summarizing the dataset
album_corpus <- corpus %>%
  group_by(artist, track.album.name, track.album.release_date) %>%
  summarise(
    danceability_min = min(danceability, na.rm = TRUE),
    danceability_max = max(danceability, na.rm = TRUE),
    danceability_median = median(danceability, na.rm = TRUE),
    danceability_mean = mean(danceability, na.rm = TRUE),
    
    energy_min = min(energy, na.rm = TRUE),
    energy_max = max(energy, na.rm = TRUE),
    energy_median = median(energy, na.rm = TRUE),
    energy_mean = mean(energy, na.rm = TRUE),
    
    loudness_min = min(loudness, na.rm = TRUE),
    loudness_max = max(loudness, na.rm = TRUE),
    loudness_median = median(loudness, na.rm = TRUE),
    loudness_mean = mean(loudness, na.rm = TRUE),
    
    speechiness_min = min(speechiness, na.rm = TRUE),
    speechiness_max = max(speechiness, na.rm = TRUE),
    speechiness_median = median(speechiness, na.rm = TRUE),
    speechiness_mean = mean(speechiness, na.rm = TRUE),
    
    acousticness_min = min(acousticness, na.rm = TRUE),
    acousticness_max = max(acousticness, na.rm = TRUE),
    acousticness_median = median(acousticness, na.rm = TRUE),
    acousticness_mean = mean(acousticness, na.rm = TRUE),
    
    liveness_min = min(liveness, na.rm = TRUE),
    liveness_max = max(liveness, na.rm = TRUE),
    liveness_median = median(liveness, na.rm = TRUE),
    liveness_mean = mean(liveness, na.rm = TRUE),
    
    valence_min = min(valence, na.rm = TRUE),
    valence_max = max(valence, na.rm = TRUE),
    valence_median = median(valence, na.rm = TRUE),
    valence_mean = mean(valence, na.rm = TRUE),
    
    tempo_min = min(tempo, na.rm = TRUE),
    tempo_max = max(tempo, na.rm = TRUE),
    tempo_median = median(tempo, na.rm = TRUE),
    tempo_mean = mean(tempo, na.rm = TRUE)
  ) %>%
  ungroup() # Ensure the summarisation doesn't carry over into subsequent operations

# View the summarized data

```

### Introduction 

This corpus encompasses a diverse array of music from nine artists: The Beatles, Red Hot Chili Peppers (RHCP), Fela Kuti, Daft Punk, Björk, Miles Davis, Radiohead, Youssou N'Dour, and Caetano Veloso. It spans various genres, including rock, funk, Afrobeat, electronic, jazz, alternative, Mbalax, and Tropicália, representing significant periods and shifts in the music industry. This selection is carefully chosen to enable a comprehensive analysis of musical evolution and the influence of cultural and socio-political contexts on musical expression.

The structure of the corpus, centered around studio-recorded albums, allows for comparisons of musical styles and thematic content. The Beatles and RHCP offer a lens into the development of rock and its subgenres, while Fela Kuti and Miles Davis add the complexity of Afrobeat and jazz. Daft Punk and Björk extend the exploration to the innovative realms of electronic music, and Radiohead combines rock with electronic sounds. The inclusion of Youssou N'Dour and Caetano Veloso incorporates the unique rhythms and melodies of Senegal and Brazil, respectively, enriching the corpus's cultural diversity.

The albums selected showcase each artist's characteristic style and include tracks that offer a contrast to their typical sound, providing a broad base for analysis. This approach, focusing on studio albums, emphasizes the nuances of production choices and artist intentions. While this corpus is substantial, it remains selective, aiming to reveal trends, contrasts, and the dynamic relationship between music and its cultural backdrop. The objective is to deepen the understanding of how music acts as a reflection of and a force upon the zeitgeist across different regions and times.

### Artist overview

```{r overview, echo=FALSE, fig_width=5,fig.height=4}
artist_data <- corpus %>%
  mutate(track_duration = track.duration_ms / 60000) %>%
  group_by(artist) %>%
  summarize(
    track_count = n(),  # Count of tracks per artist
    average_duration = mean(track_duration)  # Optional: average duration of tracks per artist
  )

treemap(artist_data,
        index = "artist",
        vSize = "track_count",
        title = "Catalog Size by Artist",
        palette = "Set3")

```


### Corpus track info

```{r treemap, echo=FALSE}
# Static plot code here
corpus <- corpus %>%
  mutate(track_info = paste(track.name, "-", track.album.name))

# Now, use 'track_info' in the 'text' aesthetic for tooltips
track_plot <- ggplot(corpus, aes(x = energy, y = danceability, color = valence, alpha = 0.8, text = track_info)) +
  geom_point() +
  facet_wrap(~artist) +
  theme_minimal() +
  guides(size = guide_legend(title = "Valence")) +
  theme(legend.text = element_text(size = 12),  # Increase legend text size
        legend.key.size = unit(1, "lines"))  # Increase legend key size

# Convert to plotly object with tooltips
track_plotly <- ggplotly(track_plot, tooltip = "text")

# Print the plotly plot
track_plotly



```

------------------------------------------------------------------------

Sidebar Tex here

### Corpus album Details

```{r explorative_plot, echo=FALSE}
# Step 1: Identify the points
album_corpus <- album_corpus %>%
  mutate(combination = energy_mean + danceability_mean) %>%
  arrange(combination) %>%
  mutate(label_position = case_when(
    row_number() == 1 ~ "Lowest",
    row_number() == n() ~ "Highest",
    TRUE ~ NA_character_
  ))

# Prepare the label text
album_corpus$label_text <- ifelse(
  !is.na(album_corpus$label_position),
  paste(album_corpus$artist, album_corpus$track.album.name, sep = ", "),
  NA
)

# Step 2: Plot with annotations
explorative_plot <- ggplot(album_corpus, aes(x = energy_mean, y = danceability_mean, color = artist)) +
    geom_point(aes(alpha = 0.4, size = valence_mean)) +
    geom_text(data = filter(album_corpus, !is.na(label_text)), 
                aes(label = label_text), 
                nudge_x = 0.03, nudge_y = 0.01,  # Adjust label location
                check_overlap = TRUE, 
                size = 2) +  # Adjust label size
    labs(title = "Energy vs. Danceability colored by Artist with Valence Size",
         x = "Energy",
         y = "Danceability",
         color = "Artist",
         size = "Valence",
         alpha = "Alpha") +
    theme_minimal() +
    guides(size = guide_legend(title = "Valence")) +
    theme(legend.text = element_text(size = 12),  # Increase legend text size
          legend.key.size = unit(1, "lines"))  # Increase legend key size

ggplotly(explorative_plot)

```

### Chroma 


### Dynamic Time Warping 


------------------------------------------------------------------------

sidebar


### Conclusion

------------------------------------------------------------------------

Sidebar
