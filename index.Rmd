---
title: "Melodic Trajectories"
author: "Gijs Oliemans"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    orientation: rows
    self_contained: false
---




```{r setup, include=FALSE}

library(flexdashboard)
library(dplyr)
library(tidyverse)
library(lubridate)
library(spotifyr)
library(plotly)
library(shiny)
library(treemap)
library(compmus)
library(cowplot)
library(patchwork)
library(gridExtra)
library(RColorBrewer)
library(tidymodels)
library(ggdendro)
library(heatmaply)
library(png)
```



```{r loading_data, include=FALSE}
corpus_raw <- readRDS(file="data/corpus-data.RDS")

```
```{r transformations, include=FALSE}
# basic data transformations
corpus_raw <- corpus_raw %>%
  mutate(track_info = paste(track.name, "-", track.album.name)) %>%
  mutate(year = substr(track.album.release_date, 1, 4)) %>%
  mutate(track_duration_minutes = track.duration_ms / 60000)

```

```{r album_corpus, include=FALSE}
# corpus grouped by albums

# Grouping and summarizing the dataset
album_corpus <- corpus_raw %>%
  group_by(artist, track.album.name, track.album.release_date, year) %>%
  summarise(
    danceability_min = min(danceability, na.rm = TRUE),
    danceability_max = max(danceability, na.rm = TRUE),
    danceability_median = median(danceability, na.rm = TRUE),
    danceability_mean = mean(danceability, na.rm = TRUE),
    danceability_sd = sd(danceability, na.rm = TRUE), # Standard deviation for danceability
    
    duration_min = min(track.duration_ms, na.rm = TRUE),
    duration_max = max(track.duration_ms, na.rm = TRUE),
    duration_median = median(track.duration_ms, na.rm = TRUE),
    duration_mean = mean(track.duration_ms, na.rm = TRUE),
    duration_sd = sd(track.duration_ms, na.rm = TRUE), # Standard deviation for danceability
    
    energy_min = min(energy, na.rm = TRUE),
    energy_max = max(energy, na.rm = TRUE),
    energy_median = median(energy, na.rm = TRUE),
    energy_mean = mean(energy, na.rm = TRUE),
    energy_sd = sd(energy, na.rm = TRUE), # Standard deviation for energy
    
    loudness_min = min(loudness, na.rm = TRUE),
    loudness_max = max(loudness, na.rm = TRUE),
    loudness_median = median(loudness, na.rm = TRUE),
    loudness_mean = mean(loudness, na.rm = TRUE),
    loudness_sd = sd(loudness, na.rm = TRUE), # Standard deviation for loudness
    
    speechiness_min = min(speechiness, na.rm = TRUE),
    speechiness_max = max(speechiness, na.rm = TRUE),
    speechiness_median = median(speechiness, na.rm = TRUE),
    speechiness_mean = mean(speechiness, na.rm = TRUE),
    speechiness_sd = sd(speechiness, na.rm = TRUE), # Standard deviation for speechiness
    
    acousticness_min = min(acousticness, na.rm = TRUE),
    acousticness_max = max(acousticness, na.rm = TRUE),
    acousticness_median = median(acousticness, na.rm = TRUE),
    acousticness_mean = mean(acousticness, na.rm = TRUE),
    acousticness_sd = sd(acousticness, na.rm = TRUE), # Standard deviation for acousticness
    
    liveness_min = min(liveness, na.rm = TRUE),
    liveness_max = max(liveness, na.rm = TRUE),
    liveness_median = median(liveness, na.rm = TRUE),
    liveness_mean = mean(liveness, na.rm = TRUE),
    liveness_sd = sd(liveness, na.rm = TRUE), # Standard deviation for liveness
    
    valence_min = min(valence, na.rm = TRUE),
    valence_max = max(valence, na.rm = TRUE),
    valence_median = median(valence, na.rm = TRUE),
    valence_mean = mean(valence, na.rm = TRUE),
    valence_sd = sd(valence, na.rm = TRUE), # Standard deviation for valence
    
    tempo_min = min(tempo, na.rm = TRUE),
    tempo_max = max(tempo, na.rm = TRUE),
    tempo_median = median(tempo, na.rm = TRUE),
    tempo_mean = mean(tempo, na.rm = TRUE),
    tempo_sd = sd(tempo, na.rm = TRUE) # Standard deviation for tempo
  ) %>%
  ungroup() # Ensure the summarisation doesn't carry over into subsequent operations


```

```{r corpus_by_artist, include=FALSE} 
# corpus grouped by artists

corpus_by_artist <- corpus_raw %>%
  group_by(artist) %>%
  reframe(
    track_count = n(),  # Count of tracks per artist
    average_duration = mean(track_duration_minutes), 
    min_year_release_date = min(year),
    max_year_release_date = max(year)
    )

```

```{r artist_corpus_analysis, include=FALSE}
album_corpus_analysis <- album_corpus %>%
  left_join(corpus_by_artist, by = "artist") %>%
  mutate(
    year = as.numeric(year),
    min_year = as.numeric(min_year_release_date),  # Convert to numeric
    max_year = as.numeric(max_year_release_date),  # Convert to numeric
    career_length = max_year - min_year + 1,
    position_in_career = year - min_year,
    career_fraction = position_in_career / career_length,
    career_cat = case_when(
      career_fraction <= 0.25 ~ "Early",
      career_fraction > 0.25 & career_fraction <= 0.5 ~ "Growth",
      career_fraction > 0.5 & career_fraction <= 0.75 ~ "Mature",
      TRUE ~ "Late"
    )
  ) %>%
  select(-career_length, -position_in_career, -career_fraction, -min_year_release_date, -max_year_release_date)  # Optionally remove intermediate columns


```
```{r, echo=FALSE}
career_cat_album <- album_corpus_analysis %>%
  select(track.album.name, career_cat)

corpus <- corpus_raw %>%
  left_join(career_cat_album, by = "track.album.name")

```

```{r density_plot_formula, include=FALSE}
create_density_plot <- function(data, x_var, title, x_label) {
  ggplot(data, aes_string(x = x_var, fill = "career_cat")) + # Use aes_string for dynamic variable names
    geom_density(alpha = 0.5) + 
    labs(title = title, x = x_label, fill = "Career Category") +
    theme_minimal() +
    scale_fill_brewer(palette = "Set1")
}
```


```{r outliers, include=FALSE}
corpus_arranged <- corpus %>%
  filter(track.duration_ms >= 12000) %>%
  mutate(combination = energy + valence) %>%
  arrange(combination) %>%
  mutate(label_position = case_when(
    row_number() == 1 ~ "Lowest",
    row_number() == n() ~ "Highest",
    TRUE ~ NA_character_
  ))

```

```{r, include=FALSE}
get_conf_mat <- function(fit) {
  outcome <- .get_tune_outcome_names(fit)
  fit |> 
    collect_predictions() |> 
    conf_mat(truth = outcome, estimate = .pred_class)
}  

get_pr <- function(fit) {
  fit |> 
    conf_mat_resampled() |> 
    group_by(Prediction) |> mutate(precision = Freq / sum(Freq)) |> 
    group_by(Truth) |> mutate(recall = Freq / sum(Freq)) |> 
    ungroup() |> filter(Prediction == Truth) |> 
    select(class = Prediction, precision, recall)
}  
```


# Introduction {.storyboard }
### What is this all about?  
```{r intro_overview, echo=FALSE}
image_path <- "index_files/figure-html/artists_grid.png"  # Replace with the actual path to your PNG image file

# Load the PNG image
image <- png::readPNG(image_path)

# Display the image
par(mar = rep(0, 4))  # Remove margins
plot.new()  # Create new plot
plot.window(xlim = c(0, 1), ylim = c(0, 1), asp = 1)  # Set plot window with aspect ratio 1
rasterImage(image, 0, 0, 1, 1)  # Display the image


```


***
On this website we explore my selected corpus and aim to research the musical journey of artist throughout their careers by leveraging the track audio featurs from the Spotify API. A little bit about me and why I've chosen this project. I'm a musician myself, playing in a band as rythm guitarist and piano player. Being in a band and creating music I've been fascinated by "finding an own sound" or "trying different things", hence I was interested in the musical journey of different artists.

This corpus encompasses a diverse array of music from nine artists: The Beatles, Red Hot Chili Peppers (RHCP), Fela Kuti, Daft Punk, Björk, Miles Davis, Radiohead, Youssou N'Dour, and Caetano Veloso. It started with music of just RHCP and The Beatles, as I was curious if the  spans various genres, including rock, funk, Afrobeat, electronic, jazz, alternative, Mbalax, and Tropicália, representing significant periods and shifts in the music industry. I've partially chosen these artists as a lot are a personal preference. I do however believe that the corpus can enable a comprehensive analysis on the musical journey of artists.

The structure of the corpus, centered around studio-recorded albums, allows for comparisons of musical styles and thematic content. The Beatles and RHCP offer a lens into the development of rock and its subgenres, while Fela Kuti and Miles Davis add the complexity of Afrobeat and jazz. Daft Punk and Björk extend the exploration to the innovative realms of electronic music, and Radiohead combines rock with electronic sounds. The inclusion of Youssou N'Dour and Caetano Veloso incorporates the unique rhythms and melodies of Senegal and Brazil, respectively, enriching the corpus's cultural diversity.

The albums selected showcase each artist's characteristic style and include tracks that offer a contrast to their typical sound, providing a broad base for analysis. This approach, focusing on studio albums, emphasizes the nuances of production choices and artist intentions. While this corpus is substantial, it remains selective, aiming to reveal trends and contrasts within the music. The objective is to deepen the understanding of how music acts as a reflection of and a force upon the zeitgeist across different genres and times.

### Dimensions of artists 

```{r artist_overview, echo=FALSE, fig_width=5,fig.height=4}
corpus_long <- corpus_by_artist %>%
  pivot_longer(cols = c(track_count, average_duration), 
               names_to = "Metric", 
               values_to = "Value")

my_labels <- c(track_count = "Amount of tracks", average_duration = "Average duration per track")

catalog_bar_charts <- ggplot(corpus_long, aes(x = reorder(artist, Value), y = Value, fill = artist)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ Metric, scales = "free_x", labeller = labeller(Metric = as_labeller(my_labels))) +
  theme_minimal() +
  labs(x = "Artist", y = " ", title = "Catalog size by artist", fill = "Artist") +  # Added a plot title
  coord_flip() +
  theme(axis.text.y = element_text(angle = 45, hjust = 1))

ggplotly(catalog_bar_charts)
```

***
This visualizations shows the catalog size of artists within my corpus. On the left side, the average duration per track is illustrated, where Caetano Veloso shows a relatively standard track length yet possesses an expansive catalog. In contrast, Fela Kuti's representation reveals a smaller number of total tracks, but each with a significantly extended duration, perhaps indicating extended instrumental characteristics of his Afrobeat style. Miles Davis's position in the middle reflects a balance within these outliers, with a high average track length consistent with jazz compositions and a substantial total track count, underscoring his extensive contribution to music. This information is essenstial to explain for construct validity in this corpus analysis as it influences various aspects of music analysis. One could imagine that standard measures of Spotify are less reliable for longer pieces of music, as Spotify's main focus is Pop music.

### Which artist makes the most happy and energetic songs?

```{r explorative_plot, echo=FALSE}
# Step 1: Identify the points
album_corpus <- album_corpus %>%
  mutate(combination = energy_mean + valence_mean) %>%
  arrange(combination) %>%
  mutate(label_position = case_when(
    row_number() == 1 ~ "Lowest",
    row_number() == n() ~ "Highest",
    TRUE ~ NA_character_
  ))

# Prepare the label text
album_corpus$label_text <- ifelse(
  !is.na(album_corpus$label_position),
  paste(album_corpus$artist, album_corpus$track.album.name, sep = ", "),
  NA
)

# Step 2: Plot with annotations
explorative_plot <- ggplot(album_corpus, aes(x = energy_mean, y = valence_mean, color = artist)) +
    geom_point(aes(alpha = 0.4, size = danceability_mean)) +
    geom_text(data = filter(album_corpus, !is.na(label_text)), 
                aes(label = label_text), 
                nudge_x = 0.03, nudge_y = 0.01,  # Adjust label location
                check_overlap = TRUE, 
                size = 2) +  # Adjust label size
    labs(title = "Energy vs. valence colored by Artist with danceability Size",
         x = "Energy",
         y = "Valence",
         color = "Artist",
         size = "Danceability",
         alpha = "Alpha") +
    theme_minimal() +
    guides(size = guide_legend(title = "Valence")) +
    theme(legend.text = element_text(size = 12),  # Increase legend text size
          legend.key.size = unit(1, "lines"))  # Increase legend key size

ggplotly(explorative_plot)

```

***

The plot included in this repository displays the distribution of track descriptives (energy, danceability and valence) of the selected corpus, grouped by albums where artists are displayed with color. All the data is extracted with the Spotify API by combining self constructed playlists. Each playlist contained all the studio album recordings of an artist, live recordings were ignored in this dataset.

Upon a close look of the plot, the albums of each artist seem to cluster both together, where Miles Davis and Björk have the most spread out descriptive variables. Artist like the Beatles, Daft Punk, Fela Kuti and RHCP (Red Hot Chili Peppers) seem to have the most concise album audio features. Youssou N'Dour and Caetano Veloso seem to stay in the middle artists like Miles Davis & Björk and artists with concise album audio features.

### Deepdive into valence and energy per artist

```{r overview, echo=FALSE}
# Static plot code here
# Now, use 'track_info' in the 'text' aesthetic for tooltips
track_plot <- ggplot(corpus, aes(x = energy, y = valence, color = track.album.name, text = track_info, alpha = 0.8)) +
  geom_point() +
  facet_wrap(~artist) +
  labs(title = "Valence vs Energy colored by danceability per artist", x = "Energy", y = "Valence") + # Title for the color scale
  theme_minimal() +
  guides(alpha = none) + # Optionally, remove the alpha guide if not needed
  theme(legend.text = element_text(size = 12),  # Increase legend text size
        legend.key.size = unit(1, "lines"),  # Increase legend key size
        legend.position = "none")  # Remove the legend

# Convert to plotly object with tooltips
track_plotly <- ggplotly(track_plot, tooltip = "text")

# Print the plotly plot
track_plotly



```

***
I wanted to show this visual to explore the variety of music per artist. In general there seem to be a positive correlation between valence and energy for all artists. There are however some artists like Björk, Caetano Veloso and RHCP who seem to create songs with a strange relationship between valence and energy. My eye fell on the valence and energy distribution of the Red Hot Chili Peppers, which' catalog exists of the most high energy songs while still keeping a relatively equal distribution of those songs with their valence score.

### What's the key? 


```{r, echo=FALSE}

corpus$mode <- as.factor(corpus$mode)
corpus_counts <- corpus %>%
  group_by(playlist_name, key, mode) %>%
  summarise(count = n(), .groups = 'drop')

# Calculate the total count of tracks for each artist
total_counts <- corpus %>%
  group_by(playlist_name) %>%
  summarise(total = n(), .groups = 'drop')

# Merge the counts with the total and calculate the proportion
corpus_proportions <- merge(corpus_counts, total_counts, by = "playlist_name") %>%
  mutate(proportion = count / total)

# Ensure 'key' is a factor with levels in the correct order for plotting
corpus_proportions$key <- factor(corpus_proportions$key, levels = as.character(0:11))


# Assuming 'key' is stored as numeric and needs to be converted for meaningful axis labels
key_labels_x <- c("C", "C#", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B")
# Create the plot
# Assuming the rest of your plotting code remains the same
key_mode_plot <- ggplot(corpus_proportions, aes(x=key, y=proportion, fill=mode)) +
  geom_bar(stat="identity", position="stack") +
  scale_x_discrete(labels=key_labels_x) +  # Assuming key_labels_x is defined as before
  scale_fill_manual(values=c("blue", "orange"), labels=c("minor", "major")) +
  facet_wrap(~ playlist_name, scales="free_y") +
  labs(x="Key", y="Proportion", title="Proportions of Keys and Modes in Artist Discographies", fill = "Mode (0 for minor and 1 for major)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1))

# Convert to plotly object
interactive_plot <- ggplotly(key_mode_plot)

# Display the interactive plot
interactive_plot

```

***

Displayed on this page are the proportional distribution plots of musical keys for each artist. To account for the varying catalog sizes, the frequency of tracks in specific keys is presented as a percentage of the total number of works in each artist's entire catalog, ensuring a normalized comparison.

For me, the most interesting distribution of keys is the one of the Beatles. There we see high occurrences of the following keys: C, D, E, G, A. (all white keys on a piano) These keys could be classified as more easy to use/understand. 

Upon closer inspection, we see the roughly the same distribution for the following artists: Caetano Veloso, Radiohead and RHCP. These artist and the beatles roughly show the same pattern of often-used keys: C, D, E, F, G, A, and B.

### What's the tempo?

```{r, echo=FALSE, fig.height=6}

# Define custom tempo bins
bin_edges <- c(60, 90, 110, 130, 150, 170, 190, 210, Inf) # Adjusted for more detail and starts from 60
bin_labels <- c("60-90", "90-110", "110-130", "130-150", "150-170", "170-190", "190-210", "210+") # Updated labels
corpus$tempo_bin <- cut(corpus$tempo, breaks=bin_edges, labels=bin_labels, include.lowest=TRUE, right=FALSE)


# Calculate counts within each bin for each playlist
corpus_counts <- corpus %>%
  filter(tempo > 60 & tempo <= 190) %>%
  group_by(playlist_name, tempo_bin) %>%
  summarise(count = n(), .groups = 'drop')

# Plot
tempo_plot <- ggplot(corpus_counts, aes(x=tempo_bin, y=count)) +
  geom_bar(stat="identity", position="stack", fill="#4CAF50") +
  facet_wrap(~ playlist_name, scales="free_y") +
  labs(x="Tempo (BPM)", y="Count", title="Distribution of Tempo per artist") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=30, hjust=1, size=6),
        axis.title.x = element_text(margin=margin(t=10, b=-20))) + 
  scale_fill_manual()

# Convert to plotly object
interactive_plot <- ggplotly(tempo_plot)

# Display the interactive plot
interactive_plot


```


***
With a tempogram for each artist, we aim to explore relations between tempo and the music produced by these artists. An interesting takeaway from this visual is the distribution of tempo for Radiohead and Björk. 

When considering tempo both Björk and Radiohead have indeed produced music that spans a broad spectrum, from slower, more contemplative tracks to faster, more rhythmically intense ones. Their discographies show a willingness to explore different tempos to suit the mood or message of each song.

For instance, Radiohead's "Everything in Its Right Place" from the album "Kid A" has a moderate tempo that creates a hypnotic and immersive listening experience, somewhat reflective of their exploration into electronic and experimental music. On the other hand, "Bodysnatchers" from "In Rainbows" has a much more aggressive tempo that conveys a sense of urgency and intensity.

Similarly, Björk's work ranges from the slower, haunting melodies of "Jóga" from "Homogenic" to the brisk, energetic beats of "Big Time Sensuality" from "Debut." Her use of tempo is often closely tied to the emotional or thematic content of her music, employing it as another layer of expression within her diverse soundscapes.

While the specific tempos of their songs might occasionally align, it's essential to note that tempo is just one aspect of their music. The overall feel and impact of a song also depend on other elements like rhythm, melody, instrumentation, and production techniques, areas where their individual styles and preferences become more pronounced.

In summary, although Björk and Radiohead might occasionally align in terms of tempo, the context in which they employ these tempos—along with their distinct approaches to melody, harmony, and production—ensures their music remains uniquely identifiable.

# Methodology {.storyboard data-navmenu="Musical Journey"}
### Methodology
```{r keys_career, include=FALSE}
analyze_artist_corpus <- function(artist_corpus) {
  # Convert mode to a factor
  artist_corpus$mode <- as.factor(artist_corpus$mode)
  
  # Calculate the count of tracks grouped by various attributes
  artist_corpus_counts <- artist_corpus %>%
    group_by(playlist_name, key, mode, career_cat) %>%
    summarise(count = n(), .groups = 'drop')
  
  # Calculate the total count of tracks for each artist
  total_counts <- artist_corpus %>%
    group_by(playlist_name) %>%
    summarise(total = n(), .groups = 'drop')
  
  # Merge the counts with the total and calculate the proportion
  artist_corpus_proportions <- merge(artist_corpus_counts, total_counts, by = "playlist_name") %>%
    mutate(proportion = count / total)
  
  # Ensure 'key' is a factor with levels in the correct order for plotting
  artist_corpus_proportions$key <- factor(artist_corpus_proportions$key, levels = as.character(0:11))
  
  # Define key labels for plotting
  key_labels_x <- c("C", "C#", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B")
  
  # Create the ggplot
  key_mode_plot <- ggplot(artist_corpus_proportions, aes(x=key, y=proportion, fill=mode)) +
    geom_bar(stat="identity", position="stack") +
    scale_x_discrete(labels=key_labels_x) +
    scale_fill_manual(values=c("blue", "orange"), labels=c("minor", "major")) +
    facet_wrap(~ career_cat, scales="free_y") +
    labs(x="Key", y="Proportion", title="Proportions of Keys and Modes in Artist Discographies", fill = "Mode (0: minor, 1: major)") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
  
  # Convert to plotly object for interactivity (optional)
  interactive_plot <- ggplotly(key_mode_plot)
  
  # Return the interactive plot
  return(interactive_plot)
}

```
```{r career_cat_distribution_plot, echo=FALSE, fig.width=10, fig.height=6}
  
career_category_distribution <- ggplot(album_corpus_analysis, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    facet_wrap(~artist, scales = "free_y") +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```


***
For each artist in my corpus, we delve into the following topics: energy, valence, tempo, track length, and key. These elements are pivotal in constructing a foundational understanding of an artist's musical expression. Energy levels help us gauge the intensity, valence measures the positivity conveyed, tempo gives the music's pace, track length offers insight into artists' exploratory tendencies, and the key provides a glimpse into the harmonic characteristics.

To glean insights into the musical journey of artists, I've segmented the corpus for every artist into four distinct 'career categories' by evenly dividing their career span. This approach allows us to observe the evolution of their musical output and stylistic shifts. On the analytical front, we utilize album distribution across these categories as a lens to view their career progression. A common pattern emerges showing an initial phase of prolific output, gradually tapering off in later years, indicative of various artistic and external influences at play.

In conclusion, this multifaceted analysis charts the musical journey of artists through their careers but also sheds light on artistic development. This study opens avenues for further exploration into the interconnectedness of musical elements, career phases, and the ever-changing music industry landscape.

# Beatles {.storyboard data-navmenu="Musical Journey"}

### About the artist
```{r beatles_intro, echo=FALSE}
beatles_corpus <- corpus %>%
  filter(artist == "Beatles")

career_category_distribution <- ggplot(beatles_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(x = "Career Category", y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```


***

The Beatles, an English rock band formed in Liverpool in 1960, revolutionized the music industry and became a cultural phenomenon. Comprising John Lennon, Paul McCartney, George Harrison, and Ringo Starr, their musical journey is marked by an unparalleled legacy of innovation and diversity. Initially influenced by rock and roll and skiffle, their early hits were characterized by youthful energy and catchy melodies. As their career progressed, they ventured into a variety of genres, from folk, blues, and Indian music to psychedelia and hard rock, showcasing their versatility and pioneering spirit.

Their albums, such as "Sgt. Pepper's Lonely Hearts Club Band," "Revolver," and "The White Album," are landmarks in the evolution of pop music, noted for their creative experimentation, sophisticated use of technology, and lyrical depth. The Beatles' impact extended beyond music; they influenced the social and cultural revolutions of the 1960s, challenging conventions and inspiring a generation.

Despite disbanding in 1970, The Beatles' music remains timeless, continuing to inspire musicians and delight fans across generations. Their innovative recording techniques, songwriting skills, and profound influence on the music industry have cemented their status as one of the greatest and most important bands in history.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/3WrFJ7ztbogyGnTHbHJFl2?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Have  the Beatles changed their energy and valence within their songs? 
```{r beatles_career, echo=FALSE}



mean_energy <- beatles_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- beatles_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
For The Beatles we see a slight drop in valence through their career while energy stays roughly the same. The high spike of valence in their early years is fitting with their rock&roll'ish songs during those years.

### How have tempo and track duration changed?
```{r beatles_tempo_duration, echo=FALSE, fig.width=10}


tempo_plot <- create_density_plot(beatles_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(beatles_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)

```

```{r, include = FALSE}

# scatterPlot <- ggplot(beatles_corpus, aes(x = valence, y = energy, color = career_cat)) +
#     geom_jitter(alpha = 1) +
#     labs(title = "Scatter Plot by Career Category", x = "Valence", y = "Energy",
#          color = "Career Category") +
#     theme_minimal()
# ggplotly(scatterPlot)

```
***

The music of the Beatles in their early years looks centered in regards to track duration and tempo. You can see their average track duration shifting upwards (and also more diverse) during their career. The tempo of songs also continued to diversity as their career progressed.

### A key career change?
```{r beatles_key, echo=FALSE}
interactive_plot <- analyze_artist_corpus(beatles_corpus)
interactive_plot
```

***
The Beatles have mostly used major keys in their work, which is consistant throughout their whole career. During all parts of their career the Beatles seem to maintain the use of the same keys in their songs. It's only the "Late" career which contains very evenly distributed songs.  This could also be because of the small amount of songs that fall into the "Late" category, consisting of 12 songs (n > 30 is normally needed in order to create a sufficient distribution).


# Björk {.storyboard data-navmenu="Musical Journey"}

### About the artist

```{r bjork_intro, echo=FALSE}
bjork_corpus <- corpus %>%
  filter(artist == "Bjork")

career_category_distribution <- ggplot(bjork_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(x = "Career Category", y = "Count", fill = "Career Category") +
    theme_minimal()
ggplotly(career_category_distribution)
```


***
Björk, the Icelandic singer-songwriter and producer, has carved a unique path in the music industry with her avant-garde approach to music and multimedia art. Since her debut album in 1977, Björk's career has been a journey of constant evolution, blending electronic, classical, pop, and experimental music with an innovative flair that is distinctly her own. Her ethereal voice and eclectic style have garnered critical acclaim and a devoted global fanbase.

Her work is characterized by a fearless exploration of new sounds and technologies, often incorporating elements of nature, technology, and personal emotion into a cohesive artistic vision. Albums like "Debut," "Post," and "Homogenic" showcase her ability to merge electronic music with heartfelt lyricism, while later works such as "Biophilia" and "Vulnicura" delve into more conceptual themes, reflecting her ongoing commitment to pushing musical boundaries.

Björk's contributions to music are not limited to her albums; she has also been involved in film, multimedia projects, and activism, further highlighting her multifaceted talent and deep connection to her Icelandic roots. Her innovative use of visuals, including groundbreaking music videos and stage performances, has redefined the possibilities of the music album as an art form. Björk remains an influential figure in contemporary music, celebrated for her originality, artistic integrity, and the emotional depth of her work.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/7w29UYBi0qsHi5RTcv3lmA?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Björk changed their energy and valence within their songs? 
```{r bjork_career, echo=FALSE}

mean_energy <- bjork_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- bjork_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
Throughout her career Björk began to make lower energy songs, while maintaining roughly the same valence score. 

### How have tempo and track duration changed?
```{r bjork_tempo_duration, fig.width=10}
tempo_plot <- create_density_plot(bjork_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(bjork_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***

Björk seems to have a very concise use of tempo and track duration throughout here whole career, with all density plots overlapping except for some outliers.

### A key career change?
```{r bjork_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(bjork_corpus)
interactive_plot
```

***
In her early and growth years, Björk looks to use roughly the same keys for her songs. Only her most recent work, there is a clear difference in the use of keys. She uses around the same amount of minor modes as she does for major ones.

# Caetano Veloso {.storyboard data-navmenu="Musical Journey"}
### About the artist

```{r caetano_intro}
caetano_veloso_corpus <- corpus %>%
  filter(artist == "Caetano Veloso")

career_category_distribution <- ggplot(caetano_veloso_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```


***
Caetano Veloso, a cornerstone of Brazilian music, has been a pivotal figure in the Tropicália movement, blending traditional Brazilian sounds with global musical influences. Since the late 1960s, Veloso has been crafting songs that weave together samba, bossa nova, rock, and folk, among other genres, making him a symbol of cultural fusion and innovation. His music not only delights the ear but also engages the mind, often addressing themes of political resistance, social justice, and personal identity.

Veloso's early work was marked by his opposition to Brazil's military dictatorship, leading to his arrest and forced exile in the late 1960s. This period of hardship only fueled his creativity, resulting in poignant albums that reflected his experiences and insights. Upon his return to Brazil, Veloso continued to explore and innovate, becoming an influential figure in the MPB (Música Popular Brasileira) genre.

His discography is vast and varied, with albums like "Transa," "Estrangeiro," and "Livro" showcasing his skill as a composer and his ability to cross cultural and musical borders. Veloso's impact extends beyond his music; he is a respected intellectual and has been a powerful voice for LGBTQ+ rights and environmental activism in Brazil.

Now in the fifth decade of his career, Caetano Veloso remains a vibrant and relevant artist, revered for his lyrical genius, musical versatility, and commitment to social causes. His work continues to inspire new generations of musicians and activists alike, solidifying his legacy as a master of Brazilian music and a champion for human rights.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/7HGNYPmbDrMkylWqeFCOIQ?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Caetano Veloso changed their energy and valence within their songs? 
```{r}

mean_energy <- caetano_veloso_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- caetano_veloso_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)

```

### How have tempo and track duration changed?
```{r caetano_tempo_duration, fig.width=10}
# Use the function to create plots
tempo_plot <- create_density_plot(caetano_veloso_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(caetano_veloso_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)

```
***
Sidebar text

### A key career change?
```{r caetano_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(caetano_veloso_corpus)
interactive_plot
```

***
Sidebar


# Daft Punk {.storyboard data-navmenu="Musical Journey"}

### About the artist
```{r, include=FALSE}
daft_punk_corpus <- corpus %>%
  filter(artist == "Daft Punk")

career_category_distribution <- ggplot(daft_punk_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```

***
Daft Punk, the French electronic music duo formed in 1993 by Thomas Bangalter and Guy-Manuel de Homem-Christo, redefined the landscape of electronic music with their innovative sound and visual presentation. Known for their anonymity and distinctive robot personas, Daft Punk's music is a blend of house, funk, disco, and synthpop, underpinned by a commitment to pushing the boundaries of music production and performance.

Their debut album, "Homework," was a critical and commercial success, introducing their signature sound to the world. However, it was their sophomore album, "Discovery," that cemented their status as pioneers, with tracks like "One More Time" and "Harder, Better, Faster, Stronger" becoming anthems of the electronic music genre. Their ability to create music that is both accessible and artistically profound has earned them a diverse and dedicated fanbase.

Daft Punk's influence extends beyond their studio albums; their live performances, particularly the 2006-2007 Alive tour, were groundbreaking in their use of visuals and stage design, setting new standards for live electronic music shows. Their work on the soundtrack for the film "Tron: Legacy" further showcased their versatility and creativity.

In 2013, Daft Punk released "Random Access Memories," an homage to the music of the 1970s and 1980s, which won multiple Grammy Awards and featured collaborations with legends like Nile Rodgers and Giorgio Moroder. Despite announcing their split in 2021, Daft Punk's legacy as innovators and icons of electronic music remains undiminished. Their music continues to influence artists across genres, ensuring their place in the pantheon of musical legends.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/2Foc5Q5nqNiosCNqttzHof?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Daft Punk changed their energy and valence within their songs? 
```{r career_daft, echo=FALSE}

mean_energy <- daft_punk_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- daft_punk_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
Sidebar text

### How have tempo and track duration changed?
```{r daft_tempo_duration, fig.width=10}
# Use the function to create plots

tempo_plot <- create_density_plot(daft_punk_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(daft_punk_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***

Sidebar text

### A key career change?
```{r daft_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(daft_punk_corpus)
interactive_plot
```

***
Sidebar text


# Fela Kuti {.storyboard data-navmenu="Musical Journey"}

### About the artist

```{r fela_intro, echo=FALSE}
fela_kuti_corpus <- corpus %>%
  filter(artist == "Fela Kuti")

career_category_distribution <- ggplot(fela_kuti_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)


```

***
Fela Kuti, the Nigerian multi-instrumentalist, composer, and the pioneer of Afrobeat, left an indelible mark on the world of music and activism. Born in 1938, Kuti's musical journey was a fusion of traditional African rhythms, jazz, funk, and highlife, creating a vibrant, energetic sound that was entirely his own. His music was not just for dancing; it carried powerful messages of resistance against political corruption, social injustice, and colonial legacies in Africa.

Kuti's band, Africa '70, was central to the Afrobeat sound, characterized by complex grooves, fiery horn sections, and percussive rhythms. Albums like "Zombie" and "Expensive Shit" were not only musical triumphs but also acts of political defiance, leading to frequent clashes with the Nigerian government and resulting in his imprisonment on several occasions.

Beyond his musical achievements, Fela Kuti was a cultural icon and a political activist, whose outspokenness and charismatic leadership made him a hero to many in Nigeria and across the African continent. His commune, the Kalakuta Republic, was a hub for countercultural movements and a symbol of resistance.

Despite his death in 1997, Kuti's legacy continues to thrive through his music, his sons Femi and Seun Kuti, who are prominent Afrobeat musicians in their own right, and the annual Felabration festival that celebrates his life and work. Fela Kuti remains an influential figure in music, recognized worldwide for his contributions to Afrobeat and his relentless fight for freedom and justice.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/5CG9X521RDFWCuAhlo6QoR?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Fela Kuti changed their energy and valence within their songs? 

```{r fela_career, echo=FALSE}

mean_energy <- fela_kuti_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- fela_kuti_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
Sidebar text

### How have tempo and track duration changed?
```{r fela_tempo_duration, fig.width=10}
# Use the function to create plots
tempo_plot <- create_density_plot(fela_kuti_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(fela_kuti_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***
Sidebar text

### A key career change?
```{r}
interactive_plot <- analyze_artist_corpus(fela_kuti_corpus)
interactive_plot

```

***
Sidebar text

# Miles Davis {.storyboard data-navmenu="Musical Journey"}

### About the artist
```{r miles_intro, echo=FALSE}
miles_davis_corpus <- corpus %>%
  filter(artist == "Miles Davis")

career_category_distribution <- ggplot(miles_davis_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)

```

***
Miles Davis, an American jazz trumpeter, bandleader, and composer, was one of the most influential and innovative figures in the history of jazz music. Over a career spanning more than five decades, Davis was at the forefront of several major developments in jazz, from bebop and cool jazz to hard bop, modal jazz, and jazz fusion. His restless creativity led to a discography that is both diverse and groundbreaking, constantly challenging and reshaping the boundaries of jazz.

Davis's 1959 album, "Kind of Blue," is a landmark in the genre, its modal jazz approach influencing generations of jazz musicians. Albums like "Bitches Brew" and "In a Silent Way" were pivotal in the development of jazz fusion, integrating electric instruments and rock and funk elements into jazz, and opening up new avenues for improvisation and composition in the genre.

Davis was known not only for his musical genius but also for his ability to assemble and mentor talented musicians, many of whom went on to become major figures in jazz themselves. His bands were incubators of talent, pushing the envelope of what jazz could be.

Despite facing challenges, including racial discrimination and struggles with addiction, Davis's contributions to music were immense. His work transcended jazz, influencing rock, funk, and electronic music, and his legacy is a testament to the power of innovation and the enduring appeal of jazz. Miles Davis remains a towering figure in music, celebrated for his artistic vision and his unparalleled contributions to the evolution of jazz.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/0kbYTNQb4Pb1rPbbaF0pT4?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Miles Davis changed their energy and valence within their songs? 
```{r miles_career, echo=FALSE}

mean_energy <- miles_davis_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- miles_davis_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
Sidebar

### How have tempo and track duration changed?
```{r miles_tempo_duration, fig.width=10}
tempo_plot <- create_density_plot(miles_davis_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(miles_davis_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***
Sidebar text

### A key career change?
```{r miles_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(miles_davis_corpus)
interactive_plot
```

***
Sidebar


# Radiohead {.storyboard data-navmenu="Musical Journey"} 
### About the artist

```{r radiohead_intro, echo=FALSE}
radiohead_corpus <- corpus %>%
  filter(artist == "Radiohead")

career_category_distribution <- ggplot(radiohead_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```

***
Radiohead, the English rock band formed in Oxfordshire in 1985, has been a driving force in alternative rock with their complex music, innovative soundscapes, and introspective lyrics. Comprising Thom Yorke, Jonny Greenwood, Colin Greenwood, Ed O'Brien, and Philip Selway, Radiohead's journey from their grunge-influenced debut album "Pablo Honey" to their groundbreaking work on "OK Computer" and beyond, showcases their willingness to experiment and evolve.

Known for their exploratory approach to music, Radiohead has delved into electronic, experimental rock, and classical music influences, creating a distinctive sound that defies easy categorization. Albums like "Kid A" and "In Rainbows" reflect their mastery of blending emotional depth with technical innovation, earning them critical acclaim and a devoted global following.

Radiohead's lyrical themes often grapple with alienation, societal issues, and the human condition, resonating with fans and reflecting the band's engagement with the world around them. Their use of multimedia in live performances and their approach to the music industry, including pioneering pay-what-you-want models for album releases, underline their status as cultural innovators.

Despite their success, Radiohead has remained enigmatic and resistant to mainstream conventions, prioritizing artistic integrity over commercial appeal. Their influence on alternative rock and contemporary music is profound, inspiring countless artists across genres. Radiohead continues to be celebrated for their innovative contributions to music and their ability to capture the complexity of modern life in their art.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/4Z8W4fKeB5YxbusRsdQVPb?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Radiohead changed their energy and valence within their songs? 

```{r radiohead_career, echo=FALSE}

mean_energy <- radiohead_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- radiohead_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)
```

***
Sidebar text

### How have tempo and track duration changed?
```{r radiohead_tempo_duration, fig.width=10}
tempo_plot <- create_density_plot(radiohead_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(radiohead_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***
Sidebar text

### A key career change?
```{r radiohead_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(radiohead_corpus)
interactive_plot
```

***
Sidebar


# RHCP {.storyboard data-navmenu="Musical Journey"}

### About the artist

```{r rhcp_intro, echo=FALSE}
rhcp_corpus <- corpus %>%
  filter(artist == "RHCP")

career_category_distribution <- ggplot(rhcp_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```

***
The Red Hot Chili Peppers, an American rock band formed in Los Angeles in 1983, are known for their energetic performances, distinctive fusion of funk, punk rock, and psychedelic rock, and the dynamic chemistry between band members. The band, consisting of Anthony Kiedis, Flea, John Frusciante, and Chad Smith, has navigated through numerous lineup changes while maintaining their unique sound and high-energy appeal.

Their music, characterized by vibrant bass lines, melodic guitar riffs, and Kiedis's rap-like vocals, captures the essence of California's cultural melting pot. Albums like "Blood Sugar Sex Magik," "Californication," and "By the Way" are pivotal in their discography, showcasing their ability to blend raw energy with more introspective lyrics and complex compositions.

The Red Hot Chili Peppers' journey is marked by both critical acclaim and personal struggles, including battles with addiction and the loss of former members. Their resilience and capacity for reinvention have kept them at the forefront of the rock scene for decades.

The band's contributions go beyond music; they are known for their activism and philanthropy, using their platform to address issues such as environmental conservation and support for music education. With a career spanning over three decades, the Red Hot Chili Peppers continue to captivate audiences around the world, embodying the spirit of innovation and the enduring appeal of rock music.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/0L8ExT028jH3ddEcZwqJJ5?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Red Hot Chili Peppers changed their energy and valence within their songs? 
```{r rhcp_career, echo=FALSE}


mean_energy <- rhcp_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- rhcp_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)

```

***
Sidebar text
### How have tempo and track duration changed?
```{r rhcp_tempo_duration, fig.width=10}
tempo_plot <- create_density_plot(rhcp_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(rhcp_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***
Sidebar text

### A key career change?
```{r rhcp_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(rhcp_corpus)
interactive_plot
```


# Youssou N'Dour {.storyboard data-navmenu="Musical Journey"}

### About the artist

```{r youssou_intro, echo=FALSE}
youssou_corpus <- corpus %>%
  filter(artist == "Youssou N'Dour")

career_category_distribution <- ggplot(youssou_corpus, aes(x = career_cat, fill = career_cat)) +
    geom_bar() +
    labs(y = "Count", fill = "Career Category") +
    theme_minimal()

ggplotly(career_category_distribution)
```

***
Youssou N'Dour, the Senegalese singer, songwriter, and composer, has been a monumental figure in world music since the late 20th century. His powerful voice and innovative fusion of traditional Senegalese music with Cuban rumba, hip hop, jazz, and soul have earned him international acclaim and a dedicated fanbase across the globe. N'Dour's music is deeply rooted in the Mbalax rhythm, which is central to Senegalese culture, yet his approach is unmistakably global, reflecting his commitment to cultural exchange and mutual understanding.

N'Dour's album "Immigrés" is widely regarded as a landmark in world music, introducing his captivating blend of West African rhythms and global musical influences to a wider audience. His collaboration with Peter Gabriel on the hit song "In Your Eyes" brought his powerful vocals to the attention of listeners worldwide, further solidifying his status as a musical ambassador.

Beyond his musical achievements, N'Dour is a respected political activist and philanthropist, using his platform to advocate for issues such as health, education, and peace in Africa. He has served as a goodwill ambassador for the United Nations and even entered the political arena in Senegal, demonstrating his deep commitment to his country and its development.

N'Dour's influence extends beyond his discography; he is a cultural icon in Senegal and an influential figure on the world stage. His work has bridged cultural divides, promoting a message of unity and understanding through the universal language of music. Youssou N'Dour remains a vital voice in world music, celebrated for his artistic excellence and his dedication to social and political causes.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/77zlytAFjPFjUKda8TNIDY?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

### Has  Youssou N'Dour changed their energy and valence within their songs? 
```{r youssou_career, echo=FALSE}

mean_energy <- youssou_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE))

mean_valence <- youssou_corpus %>%
  group_by(career_cat) %>%
  summarise(mean_valence = mean(valence, na.rm = TRUE))


mean_metrics <- full_join(mean_energy, mean_valence, by = "career_cat")

# Pivot longer so each metric is a row
mean_metrics_long <- mean_metrics %>%
  pivot_longer(cols = -career_cat, names_to = "Metric", values_to = "Value")

print(mean_metrics_long)
# Plot
grouped_bar_chart <- ggplot(mean_metrics_long, aes(x = career_cat, y = Value, fill = Metric)) +
  geom_col(position = position_dodge()) +  # Use position_dodge() to side-by-side the bars
  scale_fill_manual(values = c("mean_energy" = "blue", "mean_valence" = "red")) +  # Optional: Manual color control
  labs(x = "Career Category", y = "Value", fill = "Metric") +
  theme_minimal()

ggplotly(grouped_bar_chart)

```
***
Sidebar text
### How have tempo and track duration changed?
```{r youssou_tempo_duration, fig.width=10}
# Use the function to create plots
tempo_plot <- create_density_plot(youssou_corpus, "tempo", "Density Plot by Career Category", "Tempo")
duration_plot <- create_density_plot(youssou_corpus, "track_duration_minutes", "Density Plot by Career Category", "Track duration")

# Combine the plots
plot_grid(tempo_plot, duration_plot, ncol = 1)
```

***
Sidebar text




### A key career change?
```{r youssou_keys, echo=FALSE}
interactive_plot <- analyze_artist_corpus(youssou_corpus)
interactive_plot
```

***
Sidebar

# Conclusions {.storyboard}
### Valence and energy deepdive 

```{r valence_energy_deepdive, echo=FALSE}
track_plot <- ggplot(corpus, aes(x = energy, y = valence, color = career_cat, text = track_info, alpha = 0.9)) +
  geom_point() +
  facet_wrap(~artist) +
  labs(title = "Valence vs Energy colored by danceability per artist", x = "Energy", y = "Valence") + # Title for the color scale
  theme_minimal() +
  guides(alpha = none) + # Optionally, remove the alpha guide if not needed
  theme(legend.text = element_text(size = 12),  # Increase legend text size
        legend.key.size = unit(1, "lines"),  # Increase legend key size
        legend.position = "none")  # Remove the legend

# Convert to plotly object with tooltips
track_plotly <- ggplotly(track_plot, tooltip = "text")

# Print the plotly plot
track_plotly
```

***
Sidebar

### Valence and energy throughout the years
```{r conclusion_valence_energy, echo=FALSE}
artist_album_corpus <- corpus %>%
  group_by(artist, track.album.name, career_cat) %>%
  summarise(mean_energy = mean(energy, na.rm = TRUE),
            mean_valence = mean(valence, na.rm = TRUE),
            mean_track_duration = mean(track_duration_minutes, na.rm = TRUE),
            mean_tempo = mean(tempo, na.rm = TRUE))

artist_album_corpus_long <- artist_album_corpus %>%
  pivot_longer(cols = c(mean_energy, mean_valence), names_to = "Metric", values_to = "Value")

# Create the facet wrapped graph
facet_wrapped_valence_energy <- ggplot(artist_album_corpus_long, aes(x = career_cat, y = Value, color = Metric, group = Metric)) +
  geom_line() + # or geom_point() if you prefer dots over lines
  geom_point() +
  facet_wrap(~ artist, scales = "free_x") + # Adjust ncol as needed for layout
  labs(title = "Mean Valence and Mean Energy per Career Category by Artist",
       x = "Career Category",
       y = "Mean Value",
       color = "Metric") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Improve x-axis label readability

ggplotly(facet_wrapped_valence_energy)
```

***
Sidebar

### Tempo and song duration throughout the years
```{r tempo_duration, echo=FALSE}


facet_wrapped_tempo_duration <- ggplot(artist_album_corpus, aes(x = career_cat, y = mean_tempo, size = mean_track_duration )) +
  geom_line() + # or geom_point() if you prefer dots over lines
  geom_point() +
  facet_wrap(~ artist, scales = "free_x") + # Adjust ncol as needed for layout
  labs(title = "Mean Valence and Mean Energy per Career Category by Artist",
       x = "Career Category",
       y = "Mean Value",
       color = "Metric") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Improve x-axis label readability

ggplotly(facet_wrapped_tempo_duration)

```

***
Sidebar text


# Clustering (w12) {.storyboard data-navmenu="Required visuals"}
### Histogram

```{r, include=FALSE}
# corpus_raw <- readRDS(file="data/corpus-data.RDS")
# beatles_corpus <- corpus_raw %>%
#   filter(artist == "Daft Punk")
# 
# halloween <-
#   # get_playlist_audio_features("bnfcollection", "1vsoLSK3ArkpaIHmUaF02C") |>
#   beatles_corpus |>
#   add_audio_analysis() |>
#   mutate(
#     segments = map2(segments, key, compmus_c_transpose),
#     pitches =
#       map(segments,
#         compmus_summarise, pitches,
#         method = "mean", norm = "manhattan"
#       ),
#     timbre =
#       map(
#         segments,
#         compmus_summarise, timbre,
#         method = "mean"
#       )
#   ) |>
#   mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
#   mutate_at(vars(pitches, timbre), map, bind_rows) |>
#   unnest(cols = c(pitches, timbre))


```

```{r}


# halloween_juice <-
#   recipe(
#     track.name ~
#       danceability +
#       energy +
#       loudness +
#       speechiness +
#       acousticness +
#       instrumentalness +
#       liveness +
#       valence +
#       tempo +
#       duration +
#       C + `C#|Db` + D + `D#|Eb` +
#       E + `F` + `F#|Gb` + G +
#       `G#|Ab` + A + `A#|Bb` + B +
#       c01 + c02 + c03 + c04 + c05 + c06 +
#       c07 + c08 + c09 + c10 + c11 + c12,
#     data = halloween
#   ) |>
#   step_center(all_predictors()) |>
#   step_scale(all_predictors()) |> 
#   prep(halloween |> mutate(track.name = str_trunc(track.name, 20))) |>
#   juice() |>
#   mutate(track.name = paste(track.name, row_number(), sep = "_")) |>
#   column_to_rownames("track.name")

```

```{r}
# halloween_dist <- dist(halloween_juice, method = "euclidean")

```

```{r}
# halloween_dist |> 
#   hclust(method = "average") |> # Try single, average, and complete.
#   dendro_data() |>
#   ggdendrogram()
```

```{r, echo=FALSE, fig.height=6}

# print("hello")


```


***
Sidebar text

# Tempigram (w11) {.storyboard data-navmenu="Required visuals"}
### Histogram

```{r, echo=FALSE, fig.height=6}

# Define custom tempo bins
bin_edges <- c(60, 90, 110, 130, 150, 170, 190, 210, Inf) # Adjusted for more detail and starts from 60
bin_labels <- c("60-90", "90-110", "110-130", "130-150", "150-170", "170-190", "190-210", "210+") # Updated labels
corpus$tempo_bin <- cut(corpus$tempo, breaks=bin_edges, labels=bin_labels, include.lowest=TRUE, right=FALSE)


# Calculate counts within each bin for each playlist
corpus_counts <- corpus %>%
  filter(tempo > 60 & tempo <= 190) %>%
  group_by(playlist_name, tempo_bin) %>%
  summarise(count = n(), .groups = 'drop')

# Plot
tempo_plot <- ggplot(corpus_counts, aes(x=tempo_bin, y=count)) +
  geom_bar(stat="identity", position="stack", fill="#4CAF50") +
  facet_wrap(~ playlist_name, scales="free_y") +
  labs(x="Tempo (BPM)", y="Count", title="Distribution of Tempo per artist") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=30, hjust=1, size=6),
        axis.title.x = element_text(margin=margin(t=10, b=-20))) + 
  scale_fill_manual()

# Convert to plotly object
interactive_plot <- ggplotly(tempo_plot)

# Display the interactive plot
interactive_plot


```


***
With a tempogram for each artist, we aim to explore relations between tempo and the music produced by these artists. An interesting takeaway from this visual is the distribution of tempo for Radiohead and Björk. 

When considering tempo both Björk and Radiohead have indeed produced music that spans a broad spectrum, from slower, more contemplative tracks to faster, more rhythmically intense ones. Their discographies show a willingness to explore different tempos to suit the mood or message of each song.

For instance, Radiohead's "Everything in Its Right Place" from the album "Kid A" has a moderate tempo that creates a hypnotic and immersive listening experience, somewhat reflective of their exploration into electronic and experimental music. On the other hand, "Bodysnatchers" from "In Rainbows" has a much more aggressive tempo that conveys a sense of urgency and intensity.

Similarly, Björk's work ranges from the slower, haunting melodies of "Jóga" from "Homogenic" to the brisk, energetic beats of "Big Time Sensuality" from "Debut." Her use of tempo is often closely tied to the emotional or thematic content of her music, employing it as another layer of expression within her diverse soundscapes.

While the specific tempos of their songs might occasionally align, it's essential to note that tempo is just one aspect of their music. The overall feel and impact of a song also depend on other elements like rhythm, melody, instrumentation, and production techniques, areas where their individual styles and preferences become more pronounced.

In summary, although Björk and Radiohead might occasionally align in terms of tempo, the context in which they employ these tempos—along with their distinct approaches to melody, harmony, and production—ensures their music remains uniquely identifiable.

# How do two outliers of my corpus changed their energy and valence within their songs?  (w9){.storyboard data-navmenu="Required visuals"} 

### How do the chroma features changed their energy and valence within their songs? 
```{r data_setup, include=FALSE}
# Extracting track.id for Lowest combination
lowest_track_id <- corpus_arranged %>%
  filter(label_position == "Lowest") %>%
  pull(track.id)

# Extracting track.id for Highest combination
highest_track_id <- corpus_arranged %>%
  filter(label_position == "Highest") %>%
  pull(track.id)

print(lowest_track_id)
print(highest_track_id)
# Extracting track info for Lowest combination
lowest_track_name_album <- corpus_arranged %>%
  filter(label_position == "Lowest") %>%
  mutate(combined_info = paste(track_info, artist, sep = " - ")) %>%
  pull(combined_info)

# Extracting track info for Highest combination
highest_track_name_album <- corpus_arranged %>%
  filter(label_position == "Highest") %>%
  mutate(combined_info = paste(track_info, artist, sep = " - ")) %>%
  pull(combined_info)
```


```{r chroma_lowest, echo=FALSE, fig.width=13, fig.height=8}
lowest_energy_valence <- readRDS(file="data/lowest_energy_valence-data.RDS")
highest_energy_valence <- readRDS(file="data/highest_energy_valence-data.RDS")

##### Chromagrams
lowest_energy_valence_chromagram <-
  lowest_energy_valence |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(title= lowest_track_name_album,x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

highest_energy_valence_chromagram <-
  highest_energy_valence |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(title= highest_track_name_album,x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()




plot_grid(lowest_energy_valence_chromagram, highest_energy_valence_chromagram, 
          ncol=1
)
```

***
In the two graphs on the left side, two tracks are displayed. These tracks are outliers in my corpus, selected based on a combination of two factors: the Valence & Energy scores assigned by Spotify. I've chosen these types of outliers to explore the relationship between pitch classes and their occurrences with the Valence & Energy scores from Spotify.

The first chromagram displays a song with the lowest combination of valence & energy. In this song by Miles Davis, we see an overall absence of pitch classes, with a strong occurrence of a few (3-4) pitch classes.

In comparison with the lower chromagram, which displays a song with the highest combination of valence & energy, we see a higher occurrence of pitch classes (9-11) throughout the whole song. This energetic song by Youssou N'Dour is typical for the Mbalax genre, known for its fast-stroking percussion, as also present in this song. The percussion would explain the diversity in occurrences of pitch classes.

Overall, we could argue that the presence of a high diversity in pitch classes triggers Spotify to assign a higher Valence & Energy score.


### What does the structure of these outliers look like in self similarity matrices?
```{r data_setting_up}
# Extracting track.id for Lowest combination
lowest_track_id <- corpus_arranged %>%
  filter(label_position == "Lowest") %>%
  pull(track.id)

# Extracting track.id for Highest combination
highest_track_id <- corpus_arranged %>%
  filter(label_position == "Highest") %>%
  pull(track.id)

# Extracting track info for Lowest combination
lowest_track_name_album <- corpus_arranged %>%
  filter(label_position == "Lowest") %>%
  mutate(combined_info = paste(track_info, artist, sep = " - ")) %>%
  pull(combined_info)

# Extracting track info for Highest combination
highest_track_name_album <- corpus_arranged %>%
  filter(label_position == "Highest") %>%
  mutate(combined_info = paste(track_info, artist, sep = " - ")) %>%
  pull(combined_info)

lowest_track_artist <- corpus_arranged %>%
  filter(label_position == "Lowest") %>%
  pull(artist)

highest_track_artist <- corpus_arranged %>%
  filter(label_position == "Highest") %>%
  pull(artist)
```

```{r selfsimilarity, include=FALSE}

## getting audio analysis
lowest_track <- readRDS(file = "data/lowest_track_tidy_analysis-data.RDS")
highest_track <- readRDS(file = "data/highest_track_tidy_analysis-data.RDS")
# LOWEST CHROMA
plot_lowest_chroma <- lowest_track |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma") |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(option = "E", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "", title = "Chroma")

#LOWEST TIMBRE
plot_lowest_timbre <- lowest_track |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre") |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(option = "E", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "", title = "Timbre")
  
# HIGHEST CHROMA
plot_highest_chroma <- highest_track |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma") |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(option = "E", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "", title = "")


plot_highest_timbre <- highest_track |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre") |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(option = "E", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "", title = "")

```

```{r plotting_self_similarity, echo=FALSE}

combined_plot <- (plot_lowest_chroma | plot_lowest_timbre) /
                 (plot_highest_chroma | plot_highest_timbre)


# print(combined_plot)

plot_grid(
  plot_lowest_chroma, plot_lowest_timbre, plot_highest_chroma, plot_highest_timbre,
  ncol=2,
  labels=c("A", "", "B", ""),
  label_fontface = "plain",
  hjust = 0,
  vjust = 10
  )


```

***
These 4 graphs display the pitch and timbre self-similarity matrix of the same two songs as discussed in the "Chroma features" slide. Row "A" displays the matrices for the song by Miles Davis. Row "B" displays the matrices for the song by Youssou N'Dour.

*Row A*

For the song with the lowest combination of energy & valence, we see a clear overview of the structure of the song in both the chroma- and timbre-based self-similarity matrices. For both matrices, one could count 4-5 different parts throughout the song.

*Row B*

For the song with the highest combination of energy & valence, we see a notable difference in the chroma- and timbre-based self-similarity matrices. For the chroma-based matrix, there is no recognizable structure throughout the song. I think this is due to the fact of the percussion parts in this song, which provide a high diversity in pitch classes (due to their timbre and overtones) and therefore clutter the pitch class data. For the timbre-based matrix, clear structured parts of the song are recognizable.

Overall, we can argue that a high diversity in pitch classes can clutter the self-similarity matrix of a song, while timbre can still clearly display the structure of the same song. For a song with a lower diversity in pitch classes, this is less of a problem, and both chroma- and timbre-based self-similarity matrices display the same structure of a song.







# Keygrams, histograms and stdev (w10) {.storyboard data-navmenu="Required visuals"} 
### Keygrams
```{r chord_template, include=FALSE}
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )
```

```{r keygram_formatting, include=FALSE}
lowest_data <- readRDS(file= "data/keygram_lowest_data-data.RDS")
highest_data <- readRDS(file= "data/keygram_highest_data-data.RDS") 

plot_lowest <-
  lowest_data |> 
    compmus_match_pitch_template(
      key_templates,         # Change to chord_templates if descired
      method = "euclidean",  # Try different distance metrics
      norm = "manhattan"     # Try different norms
    ) |>
    ggplot(
      aes(x = start + duration / 2, width = duration, y = name, fill = d)
    ) +
    geom_tile() +
    scale_fill_viridis_c(guide = "none") +
    theme_minimal() +
    labs(x = "Time (s)", y = "", title = lowest_track_name_album)

plot_highest <-
  highest_data |> 
    compmus_match_pitch_template(
      key_templates,         # Change to chord_templates if descired
      method = "euclidean",  # Try different distance metrics
      norm = "manhattan"     # Try different norms
    ) |>
    ggplot(
      aes(x = start + duration / 2, width = duration, y = name, fill = d)
    ) +
    geom_tile() +
    scale_fill_viridis_c(guide = "none") +
    theme_minimal() +
    labs(x = "Time (s)", y = "", title = highest_track_name_album)
```
```{r plotting_key_analysis, echo=FALSE}
plot_grid(plot_lowest, plot_highest, 
          ncol=1
)

```

***
On the left we see the keygrams for two songs in my corpus. These tracks are extremes in my corpus, selected based on a combination of two factors: the Valence & Energy scores assigned by Spotify. 

"Julien dans l'ascenseur" by Miles Davis is the least extreme song regarding the Valence & Energy score. Throughout the song it's not super clear to see exactly which keys are used, but there are some moments on which we wee a change. One of these moments is on the  20-25s mark, which would make sense since around this time a Miles Davis starts his trumpet part. The trumpet part seems to trigger the different keys. 

"Dawal - Version Mbalax" by Youssou N'Dour is the most extreme song regarding the Valence & Energy score. For the major part of the song, there is not really one key recognisable. This is most likely due to the amount of percussion instruments in the song. If you squint your eyes, you can kind of see a repeating pattern of dark blue throughout the whole song. 


### Histograms 


```{r, echo=FALSE}

corpus$mode <- as.factor(corpus$mode)
corpus_counts <- corpus %>%
  group_by(playlist_name, key, mode) %>%
  summarise(count = n(), .groups = 'drop')

# Calculate the total count of tracks for each artist
total_counts <- corpus %>%
  group_by(playlist_name) %>%
  summarise(total = n(), .groups = 'drop')

# Merge the counts with the total and calculate the proportion
corpus_proportions <- merge(corpus_counts, total_counts, by = "playlist_name") %>%
  mutate(proportion = count / total)

# Ensure 'key' is a factor with levels in the correct order for plotting
corpus_proportions$key <- factor(corpus_proportions$key, levels = as.character(0:11))


# Assuming 'key' is stored as numeric and needs to be converted for meaningful axis labels
key_labels_x <- c("C", "C#", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B")
# Create the plot
# Assuming the rest of your plotting code remains the same
key_mode_plot <- ggplot(corpus_proportions, aes(x=key, y=proportion, fill=mode)) +
  geom_bar(stat="identity", position="stack") +
  scale_x_discrete(labels=key_labels_x) +  # Assuming key_labels_x is defined as before
  scale_fill_manual(values=c("red", "blue"), labels=c("minor", "major")) +
  facet_wrap(~ playlist_name, scales="free_y") +
  labs(x="Key", y="Proportion", title="Proportions of Keys and Modes in Artist Discographies") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1))

# Convert to plotly object
interactive_plot <- ggplotly(key_mode_plot)

# Display the interactive plot
interactive_plot

```

***

Displayed on this page are the proportional distribution plots of musical keys for each artist. To account for the varying catalog sizes, the frequency of tracks in specific keys is presented as a percentage of the total number of works in each artist's entire catalog, ensuring a normalized comparison.

For me, the most interesting distribution of keys is the one of the Beatles. There we see high occurrences of the following keys: C, D, E, G, A. (all white keys on a piano) These keys could be classified as more easy to use/understand. 

Upon closer inspection, we see the roughly the same distribution for the following artists: Caetano Veloso, Radiohead and RHCP. These artist and the beatles roughly show the same pattern of often-used keys: C, D, E, F, G, A, and B.

### Standard Deviation

```{r stdev, echo=FALSE}
scattertje <- ggplot(album_corpus, aes(
    x = tempo_mean,
    y = tempo_sd,
    colour = artist,
    size = duration_mean,
    alpha = loudness_mean
  )) + 
  geom_point() +
  geom_rug() +
  labs(
    x = "Mean Tempo (bpm)",
    y = "SD Tempo",
    colour = "Artist"
  ) +
  guides(
    size = guide_legend(title = "Duration (min)"),
    alpha = guide_legend(title = "Volume (dBFS)")
  )

ggplotly(scattertje)

```

***

In the scatterplot we see the albums as dots, colored per artist. On the x and y axis display the mean and standard deviation of tempo respectively. Because the standard deviation is calculated per album, it's generally quite high but also for most artists the same. For artist like Caetano Veloso, Fela Kuti and Miles Davis we see their albums spread out over both axes. For other artists we see their albums are more clustered together.

